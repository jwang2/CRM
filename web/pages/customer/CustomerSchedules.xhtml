<ui:composition xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:a4j="http://richfaces.org/a4j">
    <h:panelGroup>

        <h:panelGroup id="scheduleMain">
            <h:outputText value="Schedules" style="font-weight:bold;"/>
            <h:panelGroup rendered="#{customerDetailBean.customerSchedules.size()==0}">
                <br/>
                <h:outputLabel value="No Schedules Found." styleClass="no-result-found"/>
            </h:panelGroup>
            <rich:dataTable id="scheduletable" styleClass="table" rendered="true" value="#{customerDetailBean.customerSchedules}" 
                            var="item" rowClasses="jsfcrud_odd_row,jsfcrud_even_row" style="border:solid 1px; width: 100%">
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="ID"/>
                    </f:facet>
                    <a4j:commandLink execute="@this" render="updateschedule" value="#{item.id}" actionListener="#{customerDetailBean.prepareScheduleDetail(item)}" oncomplete="#{rich:component('updateschedule')}.show();return false;"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="Assigned To"/>
                    </f:facet>
                    <h:outputText value="#{item.assignedUser}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="Scheduled Time"/>
                    </f:facet>
                    <h:outputText value="#{item.scheduledDatetime}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="Status"/><br/>
                        <h:selectOneMenu value="#{customerDetailBean.currentScheduleFilter}">
                            <f:selectItems value="#{customerDetailBean.schedulesStatusFilters}"/>
                            <a4j:ajax event="valueChange" render="scheduletable" execute="@this"/>
                        </h:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{item.status}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value="Task"/>
                    </f:facet>
                    <ui:repeat value="#{item.taskCollection}" var="task">
                        <div>#{task.name}</div>
                    </ui:repeat>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <a4j:commandLink execute="@this" render="scheduleDelete" value="delete" actionListener="#{customerDetailBean.prepareScheduleDetail(item)}" oncomplete="#{rich:component('scheduleDelete')}.show();return false;"/>
                </h:column>
            </rich:dataTable>
        </h:panelGroup> 
        <br/>
        <a4j:commandButton execute="@this" render="newschedule" value="#{bundleCrm.NewScheduleButton}" actionListener="#{customerDetailBean.prepareNewSchedule()}" oncomplete="#{rich:component('newschedule')}.show();return false;"/>
        <ui:include src="/pages/customer/NewSchedule_Popup.xhtml"/>
        <ui:include src="/pages/customer/UpdateSchedule_Popup.xhtml"/>
        <ui:include src="/pages/customer/ScheduleDeletePopup.xhtml"/>
    </h:panelGroup>
</ui:composition>

